name: 'ü§ñ CI ‚Ä¢ nginx-1.28.0 ‚áß Registries'
description: 'ü§ñ CI action to build and push the NGINX v1.28.0 Docker image to multiple registries.'

on:
  workflow_dispatch:
    inputs:
      environment:
        type: choice
        default: 'dev'
        description: 'Select deployment environment'
        options: ['dev', 'qa', 'prod']
        required: true
      dockerfile:
        type: string
        default: 'Dockerfile.nginx1.28.0'
        description: 'Enter Dockerfile name'
        required: true
      registry:
        type: choice
        default: 'GitHub Container Registry'
        description: 'Select registry to push image'
        options: ['Docker Hub', 'GitHub Container Registry']
        required: true
      namespace:
        type: string
        default: balajipothula
        description: 'Enter namespace'
        required: true
      repository:
        type: string
        default: nginx
        description: 'Enter repository'
        required: true
      tag:
        type: string
        default: 1.28.0
        description: 'Enter tag'
        required: true
      docker_build-push-action_v6:
        type: boolean
        default: false
        description: 'üê≥ Docker Build & Push ·µõ‚Å∂'
        required: true
jobs:
  job_get_utc-time-now:
    name: üïí Get UTC Time Now
    runs-on: ubuntu-22.04
    steps:
      - name: Step - Get UTC Time Now
        id: step_get_utc-time-now
        run: echo "utc-time-now=$(date -u +'%Y-%m-%dT%H:%M:%SZ')" >> "$GITHUB_OUTPUT"
    outputs:
      utc-time-now: ${{ steps.step_get_utc-time-now.outputs.utc-time-now }}
  job_docker_setup-qemu-action_v3:
    name: üñ±Ô∏è Docker Setup QEMU ·µõ¬≥
    uses: ./.github/workflows/docker_setup-qemu-action_v3.yml
  job_docker_setup-buildx-action_v3:
    name: üñ±Ô∏è Docker Setup Buildx ·µõ¬≥
    needs: [job_docker_setup-qemu-action_v3]
    uses: ./.github/workflows/docker_setup-buildx-action_v3.yml
  job_docker_build-push-action_v6:
    name: üñ±Ô∏è Docker Build & Push ·µõ‚Å∂
    needs: [job_get_utc-time-now, job_docker_setup-qemu-action_v3, job_docker_setup-buildx-action_v3]
    uses: ./.github/workflows/docker_build-push-action_v6.yml
    with:
      registry: ${{ inputs.registry }}
      file: './docker/${{ inputs.dockerfile }}'
      labels: |
        org.opencontainers.image.created='${{ needs.job_get_utc-time-now.outputs.utc-time-now }}'
      load: false
      platforms: linux/amd64
      push: true
      tags: |
        ${{ (inputs.registry == 'Docker Hub' && format('{0}/{1}:{2}', inputs.namespace, inputs.repository, inputs.tag)) || (inputs.registry == 'GitHub Container Registry' && format('ghcr.io/{0}/{1}:{2}', inputs.namespace, inputs.repository, inputs.tag)) }}
    secrets:
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
      GHCR_PAT: ${{ secrets.GHCR_PAT }}
