name: 'ü§ñ CI ‚Ä¢ nginx-1.28.0 ‚áß GHCR'
description: 'ü§ñ CI action to build and push the NGINX v1.28.0 Docker image to GitHub Container Registry (GHCR).'

on:
  workflow_dispatch:
    inputs:
      environment:
        type: choice
        default: 'dev'
        description: 'Please select deployment environment'
        options: [dev, qa, prod]
        required: true
      docker_setup-qemu-action_v3:
        type: boolean
        default: false
        description: 'üê≥ Docker Setup QEMU ·µõ¬≥'
      docker_setup-buildx-action_v3:
        type: boolean
        default: false
        description: 'üê≥ Docker Setup Buildx ·µõ¬≥'
      docker_build-push-action_v6:
        type: boolean
        default: false
        description: 'üê≥ Docker Build & Push ·µõ‚Å∂'

jobs:
  job_get_utc-time-now:
    name: üïí Get UTC Time Now
    runs-on: ubuntu-22.04
    steps:
      - name: Step - Get UTC Time Now
        id: step_get_utc-time-now
        run: echo "utc-time-now=$(date -u +'%Y-%m-%dT%H:%M:%SZ')" >> "$GITHUB_OUTPUT"
    outputs:
      utc-time-now: ${{ steps.step_get_utc-time-now.outputs.utc-time-now }}
  job_docker_setup-qemu-action_v3:
    name: üñ±Ô∏è Docker Setup QEMU ·µõ¬≥
    if: ${{ inputs.docker_setup-qemu-action_v3 }}
    uses: ./.github/workflows/docker_setup-qemu-action_v3.yml
  job_docker_setup-buildx-action_v3:
    name: üñ±Ô∏è Docker Setup Buildx ·µõ¬≥
    needs: [job_docker_setup-qemu-action_v3]
    if: ${{ inputs.docker_setup-qemu-action_v3 && inputs.docker_setup-buildx-action_v3 }}
    uses: ./.github/workflows/docker_setup-buildx-action_v3.yml
  job_docker_build-push-action_v6:
    name: üñ±Ô∏è Docker Build & Push ·µõ‚Å∂
    needs: [job_get_utc-time-now, job_docker_setup-qemu-action_v3, job_docker_setup-buildx-action_v3]
    if: ${{ inputs.docker_setup-qemu-action_v3 && inputs.docker_setup-buildx-action_v3 && inputs.docker_build-push-action_v6 }}
    uses: ./.github/workflows/docker_build-push-action_v6.yml
    with:
      file: './docker/Dockerfile.nginx1.28.0'
      labels: |
        org.opencontainers.image.created='${{ needs.job_get_utc-time-now.outputs.utc-time-now }}'
      load: false
      platforms: linux/amd64
      push: true
      tags: balajipothula/nginx:1.28.0
    secrets:
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
